import type { NextPage } from "next";
import Head from "next/head";
import Script from "next/script";
import { useEffect } from "react";
import { useDispatch } from "react-redux";
import { Contact, FeatureList, Hero, Statistic } from "../components";
import { Layout } from "../components/Layouts/Layout";
import { DefaultQuery } from "../contants";
import {
  ContactInfoFunction,
  IContactInfoModel,
  IServiceModel,
  ServiceFuntions,
} from "../database";
import { setContactInfo } from "../redux/contactInfoSlide";
import { setServices } from "../redux/serviceSlide";

interface Props {
  services: IServiceModel[];
  contactInfo: IContactInfoModel;
}

const Home: NextPage<Props> = ({ services, contactInfo }) => {
  const dispatch = useDispatch();

  useEffect(() => {
    dispatch(setServices(services));
  }, [dispatch, services]);

  useEffect(() => {
    dispatch(setContactInfo(contactInfo));
  }, [contactInfo, dispatch]);

  return (
    <div>
      <Head>
        <title>Vận tải</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <Script
        src="https://cdnjs.com/libraries/bodymovin"
        type="text/javascript"
      ></Script>

      <Layout mx={{ base: 5, md: 14 }}>
        <Hero />

        <FeatureList />

        <Statistic />

        <Contact h="100vh" />
      </Layout>
    </div>
  );
};

export default Home;

export async function getServerSideProps() {
  const [services, contactInfo] = await Promise.all([
    ServiceFuntions.getByQuery(DefaultQuery),
    ContactInfoFunction.getOne({}),
  ]);

  return {
    props: {
      services: JSON.parse(JSON.stringify(services.records)),
      contactInfo: JSON.parse(JSON.stringify(contactInfo)),
    },
  };
}
